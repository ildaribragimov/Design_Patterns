<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="style.css">
        <!---->
        <script defer src="//vk.com/js/api/openapi.js" type="text/javascript"></script>
        <script defer src="/library/js/Ajax/ajax.min.js" type="text/javascript"></script>
        <script type="text/javascript">
            "use strict";
            // Исполнение скрипта после полной загрузки страницы
            window.onload = function(){

                // Инициализация API ВКонтакте
                VK.init({
                    apiId: 5218692,
                });

                // Получение сессионых данных пользователя, если он авторизован в ВКонтакте
                VK.Auth.getLoginStatus(getPageTemplate);

                function getPageTemplate(response) {
                    console.log(response);
                    if (!response.session) {
                        alert("not auth");
                        var xhr1 = new ajax({
                            url: "template/signIn.php",
                            method: "post",
                            error: function(result){
                                console.log(result);
                                document.querySelector(".window-wrapper").innerHTML = result;
                            },
                            success: function(result){
                                console.log(result);
                                //
                                var ty = result.replace(/(\s{2,})/ig, "");
                                console.log(ty);
                                
                                var rf = (/(?:<.*script[^>]*>)(.*)(?:<.*script[^>]*>)/ig).exec(ty)[1];
                                console.log(rf);

                                eval(rf);
                                
                                document.querySelector(".window-wrapper").innerHTML = result;
                            }                    
                        });
                        return;
                    }
                    // Создание экземпляра объекта "ajax"
                    var xhr = new ajax({
                        url: "vkLogin.php",
                        method: "post",
                        data: response.session,
                        error: function(result){
                            console.log(result);
                            document.querySelector(".window-wrapper").innerHTML = result;
                        },
                        success: function(result){
                            console.log(result);
                            document.querySelector(".window-wrapper").innerHTML = result;
                        }                    
                    });
                }

            };
        </script>
    </head>
    <body>
        <h1>Страница профиля посетителя, авторизованного через ВКонтакте</h1>
        <div class="window-wrapper"></div>
     </body>
</html>